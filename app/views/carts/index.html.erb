<p id="notice"><%= notice %></p>

<h1>Your cart</h1>

<table>
    <thead>
        <tr>
            <th>Item</th>
            <th>Quantity</th>
            <th>Price </th>
            <th colspan="3"></th>
        </tr>
    </thead>

    <tbody>
        <% @carts.each do |cart| %>
        <tr>
            <td><%= cart.item.name %></td>
            <td><%= cart.quantity %></td>
            <td><%= Item.find(cart.item_id).price %>
            <td><%= link_to 'Show', cart %></td>
            <td><%= link_to 'Edit', edit_cart_path(cart) %></td>
            <td><%= link_to 'Destroy', cart, method: :delete, data: { confirm: 'Are you sure?' } %></td>
        </tr>
        <% end %>
    </tbody>
</table>

<br>

<% price = 0 %>
<% Cart.all.length.times do |i| %>
<% price = price + Item.find(Cart.all[i].item_id).price %>
<% end %>

<!-- STRIPE CODE -->
<%= form_tag charges_path do %>
<article>
    <% if flash[:error].present? %>
    <div id="error_explanation">
        <p><%= flash[:error] %></p>
    </div>
    <% end %>
    <label class="amount">
        <span>Subtotal: $<%= price%></span>
    </label>
</article>

<script src="https://checkout.stripe.com/checkout.js" class="stripe-button " data-key="<%= Rails.configuration.stripe[:publishable_key] %>" data-description="Checkout" data-amount=<%= price*100 %> data-locale="auto"></script>

<!-- replaced stripe default pay button -->
<button class="btn btn-outline-primary m-1" type="submit">Pay Now</button><br>

<% end %>
<!-- EMD STRIPE CODE -->
<style media="screen">
    .stripe-button-el {
        display: none
    }
</style>